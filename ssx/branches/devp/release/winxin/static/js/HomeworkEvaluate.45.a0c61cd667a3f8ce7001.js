webpackJsonp([45],{Jl66:function(e,t,s){e.exports=s.p+"static/img/600.489e0c4.png"},app8:function(e,t,s){"use strict";t.e=function(e){return a.a.smajax("gethomeworkforteacher",e)},t.d=function(e){return a.a.smajax("gethomeworkdetailforteacher",e)},t.c=function(e){return a.a.smajax("getcoursestudentforhomework")},t.g=function(e){return a.a.smajax("ophomework",e)},t.a=function(e){return a.a.smajax("deletehomework",e)},t.f=function(e){return a.a.smajax("getmessagereadinfos",e)},t.b=function(e){return a.a.smajax("evalhomework",e)};var a=s("6PB2")},eVPN:function(e,t){},oeuR:function(e,t){},xvIB:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("//Fk"),i=s.n(a),o=s("app8"),r=s("Jl66"),n=s.n(r),l={name:"error-page",props:{type:{type:Number,default:1},text:{type:String,default:""}},data:function(){return{pages:{no600:{img:n.a,width:150,height:150}}}},computed:{page:function(){var e=this.pages["no"+this.type];return{style:{width:e.width/2+"px",height:e.height/2+"px",backgroundImage:"url("+e.img+")"}}}}},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"error-box"},[t("div",{staticClass:"error-img",style:this.page.style}),t("div",{staticClass:"error-tips"},[this._v(this._s(this.text))])])},staticRenderFns:[]};var m={name:"homework-evaluate",data:function(){return{wxTitle:"作业详情",isLoading:!0,bgType:0,refreshNum:0,errorFlag:!1,errorTips:"",complexFlag:null,showMoreNum:0,showDetailsFlag:!1,messageid:"",studentid:"",homeworkMsg:{taskTitle:"",teacherName:"",taskCreateTime:""},hadHomeWorkComment:!1,homeworkObj:{},evaluateObj:{},score:null,contentMsgModel:"",voiceArr:[],imageArr:[],contentMsg:"",mp3listClone:[],imglistClone:[]}},computed:{renderData:function(){return{showDetailsFlag:this.showDetailsFlag,refreshNum:this.refreshNum,homeworkObj:this.homeworkObj,evaluateObj:this.evaluateObj,contentMsg:this.contentMsg,contentMsgClone:this.contentMsgClone,voiceArr:this.voiceArr,imageArr:this.imageArr}}},methods:{goToHomeworkDetail:function(e){this.$router.push({path:"/homeworkDetail/"+this.messageid,query:{from:1}})},_getHomeworkEvaluate:function(){var e=this;Object(o.d)({pname:"message_detail",messageid:this.messageid,studentid:this.studentid}).then(function(t){t.result.code==app.errok?(e.homeworkMsg.taskTitle=t.data.title,e.homeworkMsg.teacherName=t.data.createuser,e.homeworkMsg.taskCreateTime=t.data.msgcreatetime,t.data.submitinfo.content=app.tool.richTextToHtml(t.data.submitinfo.content),t.data.submitinfo.content?e.complexFlag=1:t.data.submitinfo.mp3list.length>0?e.complexFlag=2:t.data.submitinfo.imglist.length>0&&(e.complexFlag=3),""!==t.data.submitinfo.content&&e.showMoreNum++,t.data.submitinfo.mp3list.length>0&&e.showMoreNum++,t.data.submitinfo.imglist.length>0&&e.showMoreNum++,e.homeworkObj=t.data.submitinfo,0==t.data.iseval?e.evaluateObj={}:(t.data.evalinfo.content=app.tool.richTextToHtml(t.data.evalinfo.content),e.contentMsg=t.data.evalinfo.content,e.score=t.data.evalinfo.score,e.mp3listClone=app.tool.clone(t.data.evalinfo.mp3list),e.imglistClone=app.tool.clone(t.data.evalinfo.imglist),e.evaluateObj=t.data.evalinfo),e.hadHomeWorkComment=1==t.data.iseval,e.isLoading=!1):400==t.result.code?(e.errorFlag=!0,e.errorTips=t.result.msg):app.toast("error",t.result.msg)})},formatDate:function(e,t){var s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?s[a]:("00"+s[a]).substr((""+s[a]).length)));return t},switchTap:function(){this.showDetailsFlag=!this.showDetailsFlag,this.refreshNum++},voiceFinished:function(e,t){var s=this;this.voiceArr=e,setTimeout(function(){s.refreshNums++})},imgUpload:function(e,t){this.imageArr=e},imageLoaded:function(){this.refreshNum++},submit:function(){var e=this;if(this.bgType=1,this.isLoading=!0,!this.score||""==app.tool.trim(this.score))return app.toast("info","请填写分数。"),void(this.isLoading=!1);if(parseInt(this.score)<0||parseInt(this.score)>100)return app.toast("info","请填写0~100整数作为分数。"),void(this.isLoading=!1);var t=[],s=[];this.voiceArr.concat(this.imageArr).forEach(function(e){e.promise&&t.push(e.promise)}),t.length>0?i.a.all(t).then(function(t){t.forEach(function(e){s.push(e)}),e.send({submitmessageid:e.homeworkObj.id,homeworkid:e.messageid,subject:e.homeworkMsg.taskTitle,content:app.tool.arrowFilter(e.contentMsgModel),mediaids:s.join(","),score:parseInt(e.score)})}).catch(function(t){e.isLoading=!1,app.toast("error","上传附件失败，请在网络畅通时重新尝试。")}):this.send({submitmessageid:this.homeworkObj.id,homeworkid:this.messageid,subject:this.homeworkMsg.taskTitle,content:app.tool.arrowFilter(this.contentMsgModel),mediaids:"",score:parseInt(this.score)})},send:function(e){var t=this;Object(o.b)(e).then(function(e){t.isLoading=!1,e.result.code==app.errok?(app.toast("success","提交成功"),1==t.$route.query.push?app.sdk.closeWindow():t.$router.back(),app.eventDefine.emit("refresh-homework-student-list"),app.eventDefine.emit("refresh-homework-list")):app.toast("error",e.errmsg)})}},created:function(){this.messageid=this.$route.params.messageid,this.studentid=this.$route.params.studentid,this._getHomeworkEvaluate()},components:{ErrorPage:s("VU/8")(l,c,!1,function(e){s("oeuR")},"data-v-7fff5a84",null).exports}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"homework-evaluate"},[s("scroller-base",{staticClass:"scroller",class:{"bottom-distance":e.hadHomeWorkComment},attrs:{data:e.renderData}},[s("div",{staticClass:"pad"},[s("div",{staticClass:"homework-msg",on:{click:function(t){e.goToHomeworkDetail(e.homeworkMsg.taskId)}}},[s("div",{staticClass:"msg-lf"},[s("div",{staticClass:"title"},[e._v(e._s(e.homeworkMsg.taskTitle))]),s("div",{staticClass:"teacher-date"},[s("div",{staticClass:"teacher"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-laoshiicon1"}})]),e._v("\n                            "+e._s(e.homeworkMsg.teacherName)+"\n                        ")]),s("div",{staticClass:"date"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-shangkeshijianicon"}})]),e._v("\n                            "+e._s(e.homeworkMsg.taskCreateTime&&e.homeworkMsg.taskCreateTime.substring(0,16))+"\n                        ")])])]),s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-youjiantou"}})])])]),s("div",{staticClass:"void"}),s("div",{staticClass:"homework-area"},[s("div",{staticClass:"student-msg"},[s("div",{staticClass:"head-img",style:"background-image:url("+e.homeworkObj.photo+")"}),s("div",[s("div",{staticClass:"name"},[e._v(e._s(e.homeworkObj.studentname))]),s("div",{staticClass:"date"},[e._v(e._s(e.homeworkObj.createtime&&e.homeworkObj.createtime.substring(0,16)))])]),s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-huidabiaoqian"}})])]),s("div",{staticClass:"content"},[""!=e.homeworkObj.content?s("div",{directives:[{name:"show",rawName:"v-show",value:1===e.complexFlag,expression:"complexFlag===1"}]},[s("div",{staticClass:"content-text",domProps:{innerHTML:e._s(e.homeworkObj.content)}})]):e._e(),e.homeworkObj.mp3list&&e.homeworkObj.mp3list.length?s("div",{directives:[{name:"show",rawName:"v-show",value:2===e.complexFlag||e.showDetailsFlag,expression:"complexFlag===2||showDetailsFlag"}],staticClass:"voice",class:{"top-distance":2===e.complexFlag}},[s("voice-recording",{attrs:{edit:!1,audioFileList:e.homeworkObj.mp3list}})],1):e._e(),e.homeworkObj.imglist&&e.homeworkObj.imglist.length?s("div",{directives:[{name:"show",rawName:"v-show",value:3===e.complexFlag||e.showDetailsFlag,expression:"complexFlag===3||showDetailsFlag"}],staticClass:"img-judge",class:{"top-distance":3===e.complexFlag}},[s("img-area",{attrs:{edit:!1,imageType:0,imageFileList:e.homeworkObj.imglist},on:{imageLoaded:e.imageLoaded}})],1):e._e()]),e.showMoreNum>1?s("div",{staticClass:"show-more",on:{click:e.switchTap}},[e.showDetailsFlag?s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-shangla"}})]),e._v("\n                        收起\n                    ")]):s("div",[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-xiala"}})]),e._v("\n                        展开更多内容\n                    ")])]):e._e()]),s("div",{staticClass:"void"}),s("div",{staticClass:"evaluate-area-title"},[s("div",{staticClass:"words-ins"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-wodedianping"}})]),e._v("\n                    我的点评\n                ")]),e.hadHomeWorkComment?s("div",{staticClass:"date"},[e._v("\n                    "+e._s(e.evaluateObj.createtime&&e.evaluateObj.createtime.substring(0,16))+"\n                ")]):e._e()]),s("div",{staticClass:"evaluate-area"},[s("div",{staticClass:"points"},[s("div",{staticClass:"words-ins"},[e._v("分数")]),s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.score,expression:"score"}],attrs:{type:"number",disabled:e.hadHomeWorkComment,placeholder:"请输入作业分数"},domProps:{value:e.score},on:{input:function(t){t.target.composing||(e.score=t.target.value)}}})])]),e.hadHomeWorkComment?""!=e.contentMsg?s("div",{staticClass:"text-wrap "},[s("div",{staticClass:"comment-text-fixed",domProps:{innerHTML:e._s(e.contentMsg)}})]):e._e():s("div",{staticClass:"text-wrap"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.contentMsgModel,expression:"contentMsgModel"}],staticClass:"comment-text",attrs:{maxlength:"500",placeholder:"写点评价吧，您的评价对这位学生会有更大的帮助哟！（500字以内）"},domProps:{value:e.contentMsgModel},on:{touchstart:function(t){e.app.area.start(t)},touchmove:function(t){e.app.area.move(t)},touchend:function(t){e.app.area.end(t)},input:function(t){t.target.composing||(e.contentMsgModel=t.target.value)}}})]),e.hadHomeWorkComment&&e.mp3listClone.length?s("div",{staticClass:"voice-wrap"},[s("voice-recording",{attrs:{edit:!1,audioFileList:e.mp3listClone},on:{voiceFinished:function(e){this.refreshNum++}}})],1):e.hadHomeWorkComment?e._e():s("div",{staticClass:"voice-wrap"},[s("voice-recording",{attrs:{edit:!0,audioFileList:e.voiceArr},on:{voiceFinished:e.voiceFinished}})],1),e.hadHomeWorkComment&&e.imglistClone.length?s("div",{staticClass:"just-show"},[s("img-area",{attrs:{edit:!1,imageType:0,imageFileList:e.imglistClone},on:{imageLoaded:e.imageLoaded}})],1):e.hadHomeWorkComment?e._e():s("div",{staticClass:"img-box"},[s("img-area",{attrs:{imageFileList:e.imageArr},on:{imageFinished:e.imgUpload,imageLoaded:e.imageLoaded}})],1)])])]),e.hadHomeWorkComment?e._e():s("div",{staticClass:"footer"},[s("div",{staticClass:"submit-btn",on:{click:e.submit}},[e._v("\n            提交\n        ")])]),s("loading",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"loading",attrs:{bgType:e.bgType}}),e.errorFlag?s("error-page",{staticClass:"error-temp",attrs:{type:600,text:e.errorTips}}):e._e()],1)},staticRenderFns:[]};var h=s("VU/8")(m,d,!1,function(e){s("eVPN")},"data-v-7fcacdca",null);t.default=h.exports}});