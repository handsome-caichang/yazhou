webpackJsonp([7],{"+AV7":function(t,e,a){"use strict";var i=a("//Fk"),n=a.n(i),s={name:"rich-text-area",props:{richText:{type:String},enableImgLoadEvent:{type:Boolean,default:!0},enableImagePreview:{type:Boolean,default:!0}},data:function(){return{_voice:"",status:0}},methods:{imageLoadHandler:function(t,e){var a=this;return new n.a(function(a){var i=parseInt(t.style.width||t.getAttribute("width")),n=parseInt(t.style.height||t.getAttribute("height"));i&&n&&i>e&&(t.style.width=e+"px",t.style.height=e/i*n+"px"),t.addEventListener("load",function(){a("onload")}),t.addEventListener("error",function(){a("onerror")})}).then(function(t){return a.enableImgLoadEvent&&a.$emit("imgLoaded"),t})},processor:function(){var t=this,e=this.$refs.richTextBox,a=e.offsetWidth,i=e.querySelectorAll("img"),s=[],r=[],o=new RegExp("^((http|https)://|data:image)");if(Array.prototype.forEach.call(i,function(e,i){var n=e.src;n&&o.test(n)?(s.push(n),r.push(t.imageLoadHandler(e,a))):(e.style.width=0,e.style.height=0)}),n.a.all(r).then(function(t){t.forEach(function(t,e){"onerror"===t&&s.splice(e,1)})}),this.enableImagePreview){var c=0;e.addEventListener("click",function(t){var e=(new Date).getTime();if(!(e-c<500)){c=e;var a=t.target;"img"===a.nodeName.toLowerCase()&&app.sdk.previewImage({current:a.src,urls:s})}})}},voiceFormat:function(){var t=this,e={loading:function(){t.status=1,t._voice.classList.add("loading")},playing:function(){t.status=2,t._voice.classList.add("play")},end:function(){t.status=0,t._voice.classList.remove("loading"),t._voice.classList.remove("play")},endAuto:function(){t.status=0,t._voice.classList.remove("loading"),t._voice.classList.remove("play")},error:function(){t.status=0,t._voice.classList.remove("loading"),t._voice.classList.remove("play")}};this.$refs.richTextBox.addEventListener("click",function(a){t._voice&&t._voice==a.target&&2==t.status?app.voice.stop():(t._voice&&t._voice!=a.target&&app.voice.stop(),t._voice=a.target,"voice"===t._voice.className&&app.voice.play(t._voice.getAttribute("url"),e))})}},mounted:function(){this.processor(),this.voiceFormat()},beforeDestroy:function(){app.voice.flag&&app.voice.stop()}},r={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"richTextBox",staticClass:"rich-text-box",domProps:{innerHTML:this._s(this.richText)}})},staticRenderFns:[]};var o=a("VU/8")(s,r,!1,function(t){a("fZfO")},null,null);e.a=o.exports},"4z9L":function(t,e,a){t.exports=a.p+"static/img/600.489e0c4.png"},"6PB2":function(t,e,a){"use strict";var i=a("Dd8w"),n=a.n(i),s=a("mw3O"),r=a.n(s);function o(t){var e=void 0,a=void 0;return t.cancelToken=new axios.CancelToken(function(t){return a=t}),(e=axios(t).then(function(t){return function(t){200!==t.data.result.code&&(540==t.data.result.code&&(location.href=app.sysInfo.wxsrvloginurl),console.error("api:"+t.config.url+" ",t.data.result))}(t),t.data}).catch(function(t){return function(t){if(console.log(t),console.log(t.response),"Error: Network Error"!=t){if(t.response){var e=t.response;e.status,console.error("http请求出错: Api:"+e.config.url),console.log(e)}}else app.toast("error","网络错误，请检查网络连接。")}(t),{result:{code:1e3,msg:t}}})).cancel=a,e}axios.ajax=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post",i=app.tool.parseQuery(),s=i.ip?""+i.ip+t:t,c=n()({_t_:(new Date).getTime()},e);return o({method:a,url:s,params:"get"===a?c:null,paramsSerializer:function(t){return r.a.stringify(t)},data:"post"===a?c:null})},axios.smajax=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post";return axios.ajax("/wx.do?appid=2&action="+t,e,a)};e.a=axios},"9/YC":function(t,e,a){"use strict";var i=a("Dd8w"),n=a.n(i),s=a("mw3O"),r=a.n(s);function o(t){var e=void 0,a=void 0;return t.cancelToken=new axios.CancelToken(function(t){return a=t}),(e=axios(t).then(function(t){return function(t){200!==t.data.result.code&&(console.error("api:"+t.config.url+" ",t.data.result),540==t.data.result.code&&(location.href=app.sysInfo.weixinparentserverurl))}(t),t.data}).catch(function(t){return function(t){if(console.log(t),console.log(t.response),"Error: Network Error"!=t){if(t.response){var e=t.response;e.status,console.error("http请求出错: Api:"+e.config.url),console.log(e)}}else app.toast("error","网络错误，请检查网络连接。")}(t),{result:{code:1e3,msg:t}}})).cancel=a,e}axios.ajax=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post",i=app.tool.parseQuery(),s=i.ip?""+i.ip+t:t,c=n()({_t_:(new Date).getTime()},e);return o({method:a,url:s,params:"get"===a?c:null,paramsSerializer:function(t){return r.a.stringify(t)},data:"post"===a?c:null})},axios.smajax=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post";return axios.ajax("/wx.do?appid=2&action="+t,e,a)};e.a=axios},H6E1:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("fTou"),n=a("oKFX"),s=a("+AV7"),r={name:"notice-detail",data:function(){return{wxTitle:1==app.tool.parseHash().query.type?"公告详情":"通知详情",isLoading:!0,page:0,detail:null,refreshNum:0,errorFlag:!1,errorTips:""}},methods:{},computed:{renderData:function(){return{refreshNum:this.refreshNum,detail:this.detail}}},created:function(){var t=this,e=app.tool.parseHash();this.page=e.query.type,(0==this.page?i.c:i.a)({id:e.hashArr[1]}).then(function(a){t.isLoading=!1,a.result.code==app.errok?(app.eventDefine.emit("notice_list_read_event",e.hashArr[1]),a.data.content=app.tool.richTextToHtml(a.data.content),t.detail=a.data):400==a.result.code?(t.errorFlag=!0,t.errorTips=a.result.msg):app.toast("error",a.result.msg)})},components:{ErrorPage:n.a,RichTextArea:s.a}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"notice-detail"},[t.detail?a("div",{staticClass:"section"},[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[t._v(t._s(t.detail.title))]),a("div",{staticClass:"info"},[a("span",[t._v(t._s(0==t.page?t.detail.createtime:t.detail.date))]),0==t.page?a("span",{staticClass:"info-user"},[t._v(t._s(t.detail.nickname)+"\n\t\t\t\t\t")]):t._e()])]),a("scroller-base",{ref:"scroller",staticClass:"scroller",attrs:{data:t.renderData}},[0==t.page?a("div",{staticClass:"content"},[a("div",{staticClass:"content-box"},[a("div",{staticClass:"content",domProps:{innerHTML:t._s(t.detail.contentpreview||t.detail.content)}})]),t.detail&&t.detail.mp3list&&t.detail.mp3list.length?a("div",{staticClass:"voice-box"},[a("voice-recording",{attrs:{edit:!1,audioFileList:t.detail.mp3list},on:{voiceFinished:function(e){t.refreshNum++}}})],1):t._e(),t.detail&&t.detail.imglist&&t.detail.imglist.length?a("div",{staticClass:"img-box"},[a("img-area",{attrs:{edit:!1,imageType:1,imageFileList:t.detail.imglist},on:{imageLoaded:function(e){t.refreshNum++}}})],1):t._e(),a("div",{staticClass:"void"})]):t._e(),1==t.page&&(t.detail.contentpreview||t.detail.content)?a("rich-text-area",{attrs:{richText:t.detail.contentpreview||t.detail.content,enableImgLoadEvent:!0,enableImagePreview:!0},on:{imgLoaded:function(e){t.refreshNum++}}}):t._e()],1)],1):t._e(),t.errorFlag?a("error-page",{staticClass:"error-temp",attrs:{type:600,text:t.errorTips}}):t._e(),a("loading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"loading",attrs:{bgType:2}})],1)},staticRenderFns:[]};var c=a("VU/8")(r,o,!1,function(t){a("e+tk")},"data-v-68f0d7a0",null);e.default=c.exports},"XR/c":function(t,e,a){"use strict";e.c=function(t){return i.a.smajax("getnoticelistforteacher",t)},e.e=function(t){return i.a.smajax("getteachernoticeinfo",t)},e.d=function(t){return i.a.smajax("getreadmessagestudent",t)},e.f=function(t){return i.a.smajax("removemessage",t)},e.a=function(t){return i.a.smajax("addpublishmessage",t)},e.b=function(t){return i.a.smajax("getclassstudentformessage",t)};var i=a("6PB2")},Zi37:function(t,e){},"e+tk":function(t,e){},fTou:function(t,e,a){"use strict";e.b=function(t){return i.a.smajax("getnoticeinfosbyeid",t)},e.d=function(t){return i.a.smajax("getteachernoticelist",t)},e.a=function(t){return i.a.smajax("getnotice",t)},e.c=function(t){return i.a.smajax("getteachernoticeinfo",t)};var i=a("9/YC")},fZfO:function(t,e){},"ip+B":function(t,e){},oKFX:function(t,e,a){"use strict";var i=a("4z9L"),n=a.n(i),s={name:"error-page",props:{type:{type:Number,default:1},text:{type:String,default:""}},data:function(){return{pages:{no600:{img:n.a,width:150,height:150}}}},computed:{page:function(){var t=this.pages["no"+this.type];return{style:{width:t.width/2+"px",height:t.height/2+"px",backgroundImage:"url("+t.img+")"}}}}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"error-box"},[e("div",{staticClass:"error-img",style:this.page.style}),e("div",{staticClass:"error-tips"},[this._v(this._s(this.text))])])},staticRenderFns:[]};var o=a("VU/8")(s,r,!1,function(t){a("Zi37")},"data-v-91b68510",null);e.a=o.exports},y2uu:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("XR/c"),n={name:"notice-detail",data:function(){return{wxTitle:"详情",title:"",createUser:"",content:"",imglist:[],mp3list:[],date:"",read:0,total:0,studentList:[],shiftName:"",isToday:!1,id:"",imgState:0}},computed:{getId:function(){return this.$router.currentRoute.params.id},contentHtml:function(){return{shiftName:this.shiftName,content:this.content,imgState:this.imgState}}},methods:{loadDtail:function(){var t=this;Object(i.e)({id:this.getId}).then(function(e){if(200==e.result.code){t.id=e.data.messageid,t.title=e.data.title,t.createUser=e.data.nickname,t.total=e.data.studentcount,t.read=e.data.isreadcount,t.date=e.data.createtime,t.content=app.tool.richTextToHtml(e.data.content),t.shiftName=e.data.classname,t.imglist=e.data.imglist,t.mp3list=e.data.mp3list;var a=t.date.split(" ")[0].split("-"),i=new Date;t.isToday=a[0]==i.getFullYear()&&a[1]==i.getMonth()+1&&a[2]==i.getDate()}})},toReadStatus:function(t){this.$router.push({path:"/noticeStudentList/"+t+"/"+this.shiftName})},removemessage:function(){var t=this,e=this.read>0?"当前消息已经有"+this.read+"人查看，确定要删除吗？":"确认删除吗？";app.confirm(e).then(function(e){e&&Object(i.f)({messageid:t.id}).then(function(e){200==e.result.code?(app.eventDefine.emit("removeItem",!0),app.toast("success","已删除。"),t.$router.back()):app.toast("error",e.ErrorMsg)})})}},mounted:function(){this.loadDtail()},beforeDestroy:function(){app.eventDefine.off("removeItem")}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"notice-detail"},[a("div",{staticClass:"body"},[a("scroller-base",{staticClass:"scroller",attrs:{data:t.contentHtml}},[a("div",{staticClass:"notice-info"},[a("div",[t._v(t._s(t.title))]),a("div",[a("span",[t._v(t._s(t.date))]),a("span",{staticClass:"color3"},[t._v(t._s(t.createUser))])])]),a("div",{staticClass:"to-students",on:{click:function(e){t.toReadStatus(t.id)}}},[a("div",[a("span",[t._v("已读"),a("em",{class:{strong:t.read!=t.total}},[t._v(t._s(t.read))]),t._v("/"+t._s(t.total)+"人")])]),a("div",[t._v("\n\t\t\t\t\t\t详情\n\t\t\t\t\t\t"),a("svg",{staticClass:"icon card-next",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#icon-youjiantou"}})])])]),a("div",{staticClass:"rich-text-container"},[a("div",[a("div",[t._v("通知内容")]),t.isToday?a("div",{on:{click:t.removemessage}},[a("svg",{staticClass:"icon icon-shanchu",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#icon-shanchu"}})]),t._v("删除\n\t\t\t\t\t\t")]):t._e()]),a("div",[a("div",{staticClass:"content-box"},[a("div",{staticClass:"content",domProps:{innerHTML:t._s(t.content)}})]),t.mp3list.length?a("div",{staticClass:"voice-box"},[a("voice-recording",{attrs:{edit:!1,audioFileList:t.mp3list},on:{voiceFinished:function(e){t.imgState++}}})],1):t._e(),t.imglist.length?a("div",{staticClass:"img-box"},[a("img-area",{attrs:{edit:!1,imageType:1,imageFileList:t.imglist},on:{imageLoaded:function(e){t.imgState++}}})],1):t._e()])])])],1)])},staticRenderFns:[]};var r=a("VU/8")(n,s,!1,function(t){a("ip+B")},"data-v-57e69f53",null);e.default=r.exports}});