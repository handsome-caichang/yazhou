webpackJsonp([20],{"+dQp":function(t,e,s){t.exports=s.p+"static/img/003.b9ab2d7.png"},"1W4h":function(t,e,s){t.exports=s.p+"static/img/006.a0ac661.png"},"2dX+":function(t,e,s){"use strict";var i=s("bwys"),n=s.n(i),a=s("nMbT"),o=s.n(a),c=s("wYIz"),l=s.n(c),r=s("DgDI"),h=s.n(r),d=s("CQNM"),u=s.n(d),p=(s("uNq/"),s("+dQp")),m=s.n(p),f=s("Sxcu"),g=s.n(f),v=s("croJ"),x=s.n(v),C=s("1W4h"),k=s.n(C),y=s("azor"),N=s.n(y),_=s("2jlb"),w=s.n(_),b=s("I5WJ"),L=s.n(b),A={name:"empty-page",props:{type:{default:1},text:{type:String,default:""}},data:function(){return{pages:{no404:{img:l.a,width:294,height:204,text:"抱歉，您找的页面可能去睡觉了"},no1000:{img:n.a,width:293,height:254,text:"网络消化不良"},no1001:{img:o.a,width:200,height:271,text:"没有找到你指定的搜索结果~"},no0:{img:h.a,width:292,height:144},no1:{img:u.a,width:259,height:264},no2:{img:u.a,width:259,height:264},no3:{img:m.a,width:271,height:225},no4:{img:g.a,width:200,height:270},no5:{img:x.a,width:200,height:270},no6:{img:k.a,width:291,height:201},no7:{img:N.a,width:211,height:221},no8:{img:w.a,width:200,height:270,text:"还没有评价和建议哦"},no9:{img:L.a,width:350,height:320,text:"建议已经被删除"}}}},computed:{page:function(){var t=this.pages["no"+this.type];return{style:{width:t.width/2+"px",height:t.height/2+"px",backgroundImage:"url("+t.img+")"},text:this.text||t.text}}}},T={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"empty-box"},[e("div",{staticClass:"empty-img",style:this.page.style}),e("div",{staticClass:"empty-tips"},[this._v(this._s(this.page.text))])])},staticRenderFns:[]};var S=s("VU/8")(A,T,!1,function(t){s("Yixk")},"data-v-6412c432",null);e.a=S.exports},"2jlb":function(t,e,s){t.exports=s.p+"static/img/008.3e0fba5.png"},CQNM:function(t,e,s){t.exports=s.p+"static/img/001.41bfc62.png"},DgDI:function(t,e,s){t.exports=s.p+"static/img/000.51c407a.png"},I5WJ:function(t,e,s){t.exports=s.p+"static/img/009.41bfc62.png"},Sxcu:function(t,e,s){t.exports=s.p+"static/img/004.0b83c59.png"},"XR/c":function(t,e,s){"use strict";e.c=function(t){return i.a.smajax("getnoticelistforteacher",t)},e.e=function(t){return i.a.smajax("getteachernoticeinfo",t)},e.d=function(t){return i.a.smajax("getreadmessagestudent",t)},e.f=function(t){return i.a.smajax("removemessage",t)},e.a=function(t){return i.a.smajax("addpublishmessage",t)},e.b=function(t){return i.a.smajax("getclassstudentformessage",t)};var i=s("6PB2")},Yhat:function(t,e){},Yixk:function(t,e){},azor:function(t,e,s){t.exports=s.p+"static/img/007.4037d25.png"},bwys:function(t,e,s){t.exports=s.p+"static/img/1000.a245c1e.png"},croJ:function(t,e,s){t.exports=s.p+"static/img/005.c11bf0d.png"},dE1m:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("//Fk"),n=s.n(i),a=s("Gu7T"),o=s.n(a),c=s("XR/c"),l=s("2dX+"),r={name:"Checked",mixins:[app.mixin.popupWindowRouteMixin],props:{opened:{},position:{type:String,default:"sideRight"},header:{},checkList:{type:Array,default:function(){return[]}}},data:function(){return{checked:!1,isAll:!1,chooseNum:0,total:0,tempList:[],acceptList:[],scrollerStyle:{}}},methods:{closeCheckedAction:function(){this.$emit("update:opened",!1)},ok:function(){this.closeCheckedAction();var t=app.tool.clone(this.tempList);this.$emit("getStudentList",{chooseNum:this.chooseNum,list:t})},chooseAll:function(){var t=this;this.isAll=!this.isAll,this.isAll?this.chooseNum=this.total:this.chooseNum=0,this.tempList.forEach(function(e){t.isAll?e.checked=!0:e.checked=!1})},itemChecked:function(t,e){t.checked=!t.checked,t.checked?++this.chooseNum:this.chooseNum>0?--this.chooseNum:this.chooseNum=0,0!=this.total&&this.chooseNum==this.total?this.isAll=!0:this.isAll=!1}},watch:{opened:function(t){if(t){this.tempList=app.tool.clone(this.checkList);var e=0;this.tempList.forEach(function(t){1==t.checked&&e++}),this.chooseNum=e,this.total=this.tempList.length,0!=this.total&&this.chooseNum==this.total?this.isAll=!0:this.isAll=!1}},checkList:function(t){this.tempList=app.tool.clone(t);var e=0;this.tempList.forEach(function(t){1==t.checked&&e++}),this.chooseNum=e,this.total=this.tempList.length,0!=this.total&&this.chooseNum==this.total?this.isAll=!0:this.isAll=!1}},components:{EmptyPage:l.a}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("action-sheet",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],staticClass:"action-sheet",attrs:{data:t.tempList,position:t.position,fullParent:!0,scrollerStyle:t.scrollerStyle,maskToClose:!1},on:{close:t.closeCheckedAction}},[0!=t.checkList.length?s("div",{staticClass:"class-name",attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.header))]):t._e(),t._l(t.tempList,function(e,i){return 0!=t.checkList.length?s("div",{key:i,staticClass:"student-item",on:{click:function(s){s.stopPropagation(),t.itemChecked(e,s)}}},[s("svg",{staticClass:"icon icon-duoxuan-weixuanze",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":0==e.checked?"#icon-duoxuan-weixuanze":"#icon-duoxuan"}})]),s("span",{staticClass:"photo",style:"background-image:url("+e.photo+")"}),s("span",{staticClass:"student-name"},[t._v(t._s(e.studentname))])]):t._e()}),s("div",{staticClass:"bottom-fixed-button",attrs:{slot:"footer"},slot:"footer"},[t.checkList.length>0?s("span",{staticClass:"flex-item-span",on:{click:t.chooseAll}},[s("svg",{staticClass:"icon icon-duoxuan-weixuanze",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":0==t.isAll?"#icon-duoxuan-weixuanze":"#icon-duoxuan"}})]),t._v("全选\n            ")]):s("span"),s("span",{staticClass:"flex-item-span",on:{click:t.ok}},[t.checkList.length>0?s("span",[t._v("确定("+t._s(t.chooseNum)+")")]):s("span",[t._v("取消")])])]),0==t.checkList.length?s("empty-page",{staticClass:"noData-temp",attrs:{type:1001,text:"该班级没有学员哦"}}):t._e()],2)},staticRenderFns:[]};var d=s("VU/8")(r,h,!1,function(t){s("kfCf")},"data-v-6655d355",null).exports,u={name:"notice-class-list",mixins:[app.mixin.popupWindowRouteMixin],props:{opened:{type:Boolean,default:!1},position:{type:String,default:"sideRight"}},data:function(){return{iconType:2,searchName:"",originalClass:[],selectedClass:[],acceptStudents:[],backupData:[],checked:{opened:!1,classname:"",list:[]},classid:null,isAll:!1,chooseNum:0,selectClass:null,selectList:null,counter:0,scrollerStyle:{background:"#eef1f6"},isLoading:!1,opentFilter:!1,sortTitle:"班级列表排序选择",sortTag:[{name:"默认"},{name:"班级名称"},{name:"上课时间"}]}},methods:{searchClassName:function(){var t=this;if(""!=this.searchName){0==this.backupData.length&&(this.backupData=[].concat(o()(this.originalClass)));var e=this.originalClass.filter(function(e){return e.classname.indexOf(t.searchName)>-1});this.originalClass=[].concat(o()(e))}else this.backupData.length>0&&(this.originalClass=[].concat(o()(this.backupData)))},openSort:function(){this.opentFilter=!this.opentFilter},filterType:function(t){var e={sort:0==t.index||1==t.index?"name":"date",desc:t.desc?0:1};this._getClassList(e.desc,e.sort)},chooseClass:function(t){t.checked=!t.checked,t.chooseNum=t.checked?t.amount:0;var e=0;this.originalClass.forEach(function(s){t.studentlist=[],t.selectAll=!0,e+=s.chooseNum}),this.counter=e,this.isAll=this.originalClass.every(function(t){return t.checked})},closeClassAction:function(){this.$emit("update:opened",!1)},ok:function(){this.selectedClass=app.tool.clone(this.originalClass),delete this.selectedClass.messagestudentinfo,this.$emit("getAccpets",this.selectedClass.filter(function(t){return t.selectAll||t.chooseNum>0})),this.closeClassAction()},chooseAll:function(){var t=this,e=0;this.isAll=!this.isAll,this.originalClass.forEach(function(s){t.isAll?(s.checked=!0,s.chooseNum=s.amount,s.studentlist=[],s.selectAll=!0,e+=s.amount):(s.checked=!1,s.chooseNum=0,s.selectAll=!1)}),this.counter=e},chooseStudent:function(t){var e=this;if(e.checked.opened=!0,e.classid=t.classid,e.checked.classname=t.classname,e.acceptStudents.some(function(t){return e.classid==t.classid}))e.checked.list=e.acceptStudents.filter(function(t){return t.classid==e.classid})[0].studentlist;else{t.messagestudentinfo.forEach(function(t){t.isread=0}),e.checked.list=[].concat(o()(t.messagestudentinfo));var s=this.studentAllChoose(t);e.checked.list.forEach(function(t,e){t.checked=!!s,t.index=e})}0!=t.chooseNum&&t.chooseNum==e.checked.list.length&&e.checked.list.forEach(function(t){t.checked=!0})},getStudentList:function(t){console.log(t);var e=this;e.acceptStudents.length>0?e.acceptStudents.forEach(function(s){s.classid===e.classid?(s.studentlist=t.list,s.chooseNum=t.chooseNum):e.acceptStudents.push({classid:e.classid,classname:e.checked.classname,chooseNum:t.chooseNum,studentlist:t.list})}):e.acceptStudents.push({classid:e.classid,classname:e.checked.classname,chooseNum:t.chooseNum,studentlist:t.list}),e.counter=0,e.originalClass.forEach(function(s){s.classid===e.classid&&(s.chooseNum=t.chooseNum,s.studentlist=t.list.filter(function(t){return t.checked})),0!=s.amount&&s.amount==s.chooseNum?s.checked=!0:s.checked=!1,e.counter=e.counter+s.chooseNum,s.selectAll=s.checked})},studentAllChoose:function(t){return this.originalClass.filter(function(t){return t.chooseNum>0}).some(function(e){return t.classid==e.classid})},_getClassList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";this.isLoading=!0;var i=this,n={uid:app.sysInfo.id,userrole:4==app.sysInfo.currole.id?3:16==app.sysInfo.currole.id?1:2,sortfield:s,isdesc:e,querybyname:""};Object(c.b)(n).then(function(e){t.isLoading=!1,200==e.result.code&&(i.originalClass=e.data.messageshiftinfo,i.originalClass.forEach(function(t){i.$set(t,"checked",!1),i.$set(t,"chooseNum",0)}))})}},watch:{opened:function(t){t&&(this.selectedClass.length>0?(this.originalClass=app.tool.clone(this.selectedClass),this.isLoading=!1):this._getClassList())}},components:{EmptyPage:l.a,Checked:d}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"notice-class-container"},[s("action-sheet",{directives:[{name:"show",rawName:"v-show",value:t.opened,expression:"opened"}],ref:"noticeClassAS",staticClass:"action-sheet",attrs:{position:t.position,scrollerStyle:t.scrollerStyle,fullParent:!0,data:t.originalClass},on:{close:t.closeClassAction}},[s("div",{staticClass:"top-search",attrs:{slot:"header"},slot:"header"},[s("div",{staticClass:"search-classname"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchName,expression:"searchName"}],attrs:{type:"text",placeholder:"班级名称"},domProps:{value:t.searchName},on:{input:function(e){e.target.composing||(t.searchName=e.target.value)}}}),s("span",{on:{click:t.searchClassName}},[t._v("搜索")])]),s("div",{staticClass:"rank-class-time",on:{click:t.openSort}},[t._v("\n                  排序\n              ")])]),t._l(t.originalClass,function(e,i){return s("div",{key:e.classid,staticClass:"to-detail"},[s("div",{staticClass:"left-div"},[s("svg",{staticClass:"icon icon-duoxuan",attrs:{"aria-hidden":"true"},on:{click:function(s){t.chooseClass(e)}}},[s("use",{attrs:{"xlink:href":0==e.checked?"#icon-duoxuan-weixuanze":"#icon-duoxuan"}})])]),s("div",{staticClass:"right-div",on:{click:function(s){t.chooseStudent(e)}}},[s("div",[s("span",{staticClass:"name"},[t._v(t._s(e.classname))]),s("span",{staticClass:"reads"},[t._v("("),s("span",{class:{strong:0!=e.chooseNum}},[t._v(t._s(e.chooseNum))]),t._v("/"+t._s(e.amount)+")")]),s("span",{staticClass:"campusname"},[t._v(t._s(e.campusname))])]),s("svg",{staticClass:"icon card-next",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-youjiantou"}})])])])}),0==t.originalClass.length?s("empty-page",{staticClass:"noData-temp",attrs:{type:1001,text:"没有找到班级哦"}}):t._e(),s("div",{staticClass:"bottom-fixed-button",attrs:{slot:"footer"},slot:"footer"},[t.originalClass.length>0?s("span",{staticClass:"flex-item-span",on:{click:t.chooseAll}},[s("svg",{staticClass:"icon icon-duoxuan",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":0==t.isAll?"#icon-duoxuan-weixuanze":"#icon-duoxuan"}})]),t._v("\n                  全选\n              ")]):s("span"),s("span",{staticClass:"flex-item-span",on:{click:t.ok}},[t.originalClass.length>0?s("span",[t._v("确定("+t._s(t.counter)+")")]):s("span",[t._v("取消")])])])],2),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"loading"}),s("sort-sheet",{attrs:{list:t.sortTag,opened:t.opentFilter,title:t.sortTitle,initType:"1-0"},on:{"update:opened":function(e){t.opentFilter=e},clickSort:t.filterType}}),s("Checked",{ref:"checked",attrs:{opened:t.checked.opened,checkList:t.checked.list,header:t.checked.classname},on:{"update:opened":function(e){t.$set(t.checked,"opened",e)},getStudentList:t.getStudentList}})],1)},staticRenderFns:[]};var m={name:"public-page",components:{NoticeClassList:s("VU/8")(u,p,!1,function(t){s("Yhat")},"data-v-08058fd0",null).exports},data:function(){return{wxTitle:"发布通知",accpetItemTxt:"",accpetItem:[],placeholderTxt:"请选择",title:"",content:"",imgUploadOp:{add:[]},voiceUploadOp:{add:[]},isFile:0,contentType:0,media_ids:"",media_url:"",opened:!1,prevTime:0,clientType:"wx"==app.env?0:1,isLoading:!1}},computed:{contentHtml:function(){return{img:this.imgUploadOp.add,voice:this.voiceUploadOp.add,classList:this.accpetItemTxt}}},methods:{closeClassAction:function(){this.opened=!0},getAccpets:function(t){var e=this,s="",i=t.filter(function(t){return t.chooseNum>0});i.length>0?(i.forEach(function(t){s+='<span class="items" style="background: rgba(224,229,238,1);border-radius: 100px;padding: 0 10px;margin: 5px 10px;">'+t.classname+" ("+t.chooseNum+")名学生</span>",e.placeholderTxt=""}),this.accpetItemTxt=s,this.accpetItem=app.tool.clone(i)):(this.placeholderTxt="请选择",this.accpetItemTxt="")},imageFinished:function(t){this.imgUploadOp.add=t},voiceFinished:function(t){this.voiceUploadOp.add=t},addNoticeFn:function(){var t=this;if(!((new Date).getTime()-this.prevTime<1e3)){var e=this.accpetItem.filter(function(t){return t.chooseNum>0}),s=0;if(e.forEach(function(t){return s+=t.chooseNum}),0!=e.length)if(s>parseInt(app.sysInfo.sendtaskornoticelimit))app.toast("info","接收人数已超过"+app.sysInfo.sendtaskornoticelimit+"人限制，请重新选择。");else if(0!=this.title.length)if(this.title.length>50)app.toast("info","标题长度不超过50。");else{var i=[],a=0;this.voiceUploadOp.add.forEach(function(t){return i.push(t.promise)}),this.imgUploadOp.add.forEach(function(t){return i.push(t.promise)}),0!=this.content.length||0!=i.length?(this.isLoading=!0,1==this.clientType&&(a=this.voiceUploadOp.add.length),i.length>0?(this.contentType=3,this.isFile=1,n.a.all(i).then(function(e){var s=[],i=[];e.forEach(function(e,n){0==t.clientType?s.push(e):a-1<n?i.push(e):s.push(e)}),t.media_ids=s.join(","),1==t.clientType&&(t.media_url=i.join(",")),t.send()}).catch(function(t){app.toast("error","上传附件失败，请在网络畅通时重新尝试。")})):(this.contentType=0,this.isFile=0,this.prevTime=(new Date).getTime(),this.send())):app.toast("info","请输入通知内容。")}else app.toast("info","请输入标题。");else app.toast("info","请选择接收人。")}},send:function(){var t=this,e={clientType:this.clientType,content:app.tool.arrowFilter(this.content),publishinfolist:this.accpetItem,title:this.title,isfile:this.isFile,teacheruserid:app.sysInfo.id,contenttype:this.contentType,mediaids:this.media_ids,type:4,istemp:0};Object(c.a)(e).then(function(e){200==e.result.code?(app.toast("success","发送成功。"),app.eventDefine.emit("refresh"),t.$router.back()):app.toast("error",e.result.msg),setTimeout(function(){t.isLoading=!1},300)})}},beforeDestroy:function(){app.eventDefine.off("refresh")}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"notice-add"},[s("div",{staticClass:"body"},[s("scroller-base",{ref:"noticeAddScrollerBase",staticClass:"scroller",attrs:{data:t.contentHtml}},[s("div",{staticClass:"flex-space-between",on:{click:t.closeClassAction}},[s("span",[t._v("接收人")]),s("span",[s("span",{staticClass:"right-span"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.placeholderTxt)+"\n\t\t\t\t\t\t")]),s("svg",{staticClass:"icon card-next",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-youjiantou"}})])])]),s("div",{staticClass:"accept-itme",domProps:{innerHTML:t._s(t.accpetItemTxt)}}),s("div",{staticClass:"flex-space-between add-title"},[s("span",[t._v("标题")]),s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"请输入标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})])]),s("div",{staticClass:"add-content"},[s("div",{staticClass:"txt"},[s("div",[t._v("内容")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{name:"notice-content",id:"",cols:"30",rows:"10",placeholder:"写点儿什么吧！"},domProps:{value:t.content},on:{touchmove:[function(t){t.stopPropagation()},function(e){t.app.area.move(e)}],touchstart:function(e){t.app.area.start(e)},touchend:function(e){t.app.area.end(e)},input:function(e){e.target.composing||(t.content=e.target.value)}}})]),s("div",{staticClass:"voice"},[s("voice-recording",{attrs:{edit:!0},on:{voiceFinished:t.voiceFinished}})],1),s("div",{staticClass:"img-area"},[s("img-area",{attrs:{maxImgNum:9},on:{imageFinished:t.imageFinished}})],1)])]),s("div",{staticClass:"bottom-fixed-button"},[s("button",{on:{click:t.addNoticeFn}},[t._v("提交")])])],1),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"loading",attrs:{bgType:1}}),s("NoticeClassList",{ref:"noticeClassList",attrs:{opened:t.opened},on:{"update:opened":function(e){t.opened=e},getAccpets:t.getAccpets}})],1)},staticRenderFns:[]};var g=s("VU/8")(m,f,!1,function(t){s("vs7/")},"data-v-d9fa9b24",null);e.default=g.exports},kfCf:function(t,e){},nMbT:function(t,e,s){t.exports=s.p+"static/img/1001.d7ee272.png"},"uNq/":function(t,e,s){t.exports=s.p+"static/img/002.0fbc03b.png"},"vs7/":function(t,e){},wYIz:function(t,e,s){t.exports=s.p+"static/img/404.49a5047.png"}});