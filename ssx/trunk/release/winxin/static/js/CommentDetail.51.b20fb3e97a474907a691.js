webpackJsonp([51],{"3QFn":function(t,e){},E1Mn:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),a=s.n(i),n=s("zGAN"),c={props:{starsDesc:{type:Array,default:function(){return[]}},isClick:{type:Boolean,default:!1},title:{type:String},desc:{type:String},groupIndex:{type:Number,default:0},selectedStarsNum:{type:Number,default:-1},isFinished:{type:Number,default:0}},data:function(){return{showTagsArr:[],starsArr:[],scope:-1,isShowShangla:!1}},computed:{},methods:{computedScope:function(t){},selectStar:function(t,e){var s=this;if(this.isClick)if(1!==this.isFinished){for(var i=0;i<this.showTagsArr.length;i++)this.showTagsArr[i]=!1;var a=void 0;e==this.scope?(this.scope=e-1,a=e):(this.scope=e,a=e+1,this.showTagsArr.splice(e,1,!0)),setTimeout(function(){s.showTagsArr.splice(e,1,!1)},1500);var n={scope:a,scopIndex:this.groupIndex,settingID:this.settingID};this.$emit("selectStar",n)}else app.toast("info","该班级已经结业，不能继续评价。")},pullDown:function(){this.isShowShangla=!this.isShowShangla,this.$emit("addScrollNum")}},mounted:function(){var t=this;this.starsDesc.forEach(function(e){t.showTagsArr.push(!1)}),this.scope=this.selectedStarsNum},watch:{starsDesc:function(t){t&&console.log(t)}}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment-star"},[s("div",{staticClass:"comment-star-hd"},[t.title?s("div",{staticClass:"star-name"},[t._v(t._s(t.title))]):t._e(),t._l(t.starsDesc,function(e,i){return t.isClick?s("div",{staticClass:"star-content"},[s("svg",{staticClass:"icon star",attrs:{"aria-hidden":"true"},on:{click:function(s){t.selectStar(e,i)}}},[s("use",{attrs:{"xlink:href":t.scope>=i?"#icon-xingxingxuanzhong":"#icon-xingxingweixuanzhong"}})]),t.showTagsArr[i]&&e.describe?s("div",{staticClass:"star-tips-wrapper"},[s("div",{ref:"starTips",refInFor:!0,staticClass:"star-tips"},[t._v("\n                "+t._s(e.describe)+"\n                ")])]):t._e()]):t._e()}),t._l(t.starsDesc,function(e,i){return t.isClick?t._e():s("div",{staticClass:"star-content"},[s("svg",{staticClass:"icon star",attrs:{"aria-hidden":"true"},on:{click:function(s){t.selectStar(e,i)}}},[s("use",{attrs:{"xlink:href":t.scope>i?"#icon-xingxingxuanzhong":"#icon-xingxingweixuanzhong"}})]),t.showTagsArr[i]&&e.Describe?s("div",{staticClass:"star-tips-wrapper"},[s("div",{ref:"starTips",refInFor:!0,staticClass:"star-tips"},[t._v("\n                "+t._s(e.Describe)+"\n                ")])]):t._e()])}),s("div",{staticClass:"star-more"},[t.desc?s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"},on:{click:t.pullDown}},[s("use",{attrs:{"xlink:href":t.isShowShangla?"#icon-shangla":"#icon-xiala"}})]):t._e()])],2),t.isShowShangla?s("div",{staticClass:"comment-star-bd"},[t._v("\n        "+t._s(t.desc)+"\n    ")]):t._e()])},staticRenderFns:[]};var o=s("VU/8")(c,r,!1,function(t){s("HR7F")},"data-v-803a68ee",null).exports,d={name:"comment-detail",computed:a()({},Vuex.mapState(["userConfig"]),{dateStr:function(){var t="";if(3===this.detail.unit){var e=void 0;if((e=this.detail.datedetail.split(" ")).length)for(var s=0;s<e.length;s++)e[s].indexOf("~")<0&&(t=t+" "+e[s])}else t=this.detail.datedetail;return t},renderData:function(){return{detail:this.detail,clickNum:this.clickNum}},commentTips:function(){var t="";return this.detail.studentscope.length>0&&(t+="其他"),t+="意见和建议（匿名发送，请放心填写",this.detail.addpoint&&(t+="，还可以获得"+this.detail.addpoint+"个积分哦！"),t+="）"}}),data:function(){return{detail:null,clickNum:0,isLoading:!0,clickIndex:0,content:"",selectStars:[],wxTitle:"评价详情",teacherScope:0,queryPara:null}},methods:{addScrollNum:function(){this.clickNum++},selectStar:function(t){this.selectStars[t.scopIndex].scope=t.scope},sendComment:function(){var t=this;this.isLoading=!0;var e={courseId:this.queryPara.courseid,studentId:this.userConfig.userId,content:app.tool.arrowFilter(this.content),contenttype:0,coursecommentscopeinfos:this.selectStars};Object(n.d)(e).then(function(e){e.result.code==app.errok?(t.$nextTick(function(){history.length>1?t.$router.go(-1):t.$router.replace("/home/0")}),app.event.emit("selectStar")):app.toast("info",e.result.msg),setTimeout(function(){t.isLoading=!1},300)})},submitComment:function(){var t=this;if(this.detail.studentscope.length){for(var e=!1,s=!1,i=0;i<this.selectStars.length;i++)if(this.selectStars[i].scope>0){e=!0;break}if(!e)return void app.toast("info","给老师评个分吧^_^。");for(var a=0;a<this.detail.studentscope.length;a++)if(0===this.selectStars[a].scope&&1==this.detail.studentscope[a].ismust)return void app.toast("info","请对"+this.detail.studentscope[a].name+"进行评价。");for(var n=0;n<this.selectStars.length;n++)if(this.selectStars[n].scope>this.detail.low){s=!0;break}if(!s&&""===this.content)return void app.confirm({title:"提示",text:"您的评分很低,请给出差评理由",btns:[{text:"直接提交",style:{},action:"submit"},{text:"好",style:{color:"#1E88F5"},action:"giveup"}]}).then(function(e){"submit"===e?t.sendComment():t.$nextTick(function(){return t.$refs.textarea.focus()})})}this.sendComment()}},created:function(){var t=this;this.queryPara=this.$route.params;var e={courseid:this.queryPara.courseid,companyid:this.userConfig.companyID,studentid:app.sysInfo.userId};Object(n.b)(e).then(function(e){if(t.isLoading=!1,e.result.code==app.errok){t.detail=e.data,t.detail.teacherscope=t.detail.teacherscope.filter(function(t){return t.scope>0}),1==t.detail.isfinished&&0==t.detail.isstudentevad&&app.confirm({title:"班级结业",text:"该班级已经结业,不能继续评价，点击关闭页面"}).then(function(e){e&&t.$router.push({path:"/commentList"})}),t.selectStars=t.detail.studentscope.map(function(t){return{scope:t.scope,settingID:t.id}});for(var s=0;s<t.detail.teacherscope.length;s++)t.teacherScope+=t.detail.teacherscope[s].scope}})},components:{Star:o}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.detail?s("scroller-base",{staticClass:"comment-detail",attrs:{data:t.renderData}},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-hd"},[t._v("上课详情")]),s("div",{staticClass:"cinfo"},[s("div",{staticClass:"cinfo-item"},[s("div",{staticClass:"cinfo-item-title"},[t._v("班级")]),s("div",{staticClass:"cinfo-item-content"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.detail.classname)),t.detail.subjectname?s("span",[t._v("-"+t._s(t.detail.subjectname))]):t._e()])]),s("div",{staticClass:"cinfo-item"},[s("div",{staticClass:"cinfo-item-title"},[t._v("老师")]),s("div",{staticClass:"cinfo-item-content"},[t._v("\n                            "+t._s(t.detail.teachername)+"\n                        ")])]),s("div",{staticClass:"cinfo-item"},[s("div",{staticClass:"cinfo-item-title"},[t._v("信息")]),s("div",{staticClass:"cinfo-item-content"},[s("div",[t._v(t._s(t.dateStr))]),t.detail.ShiftContent?s("div",[t._v(t._s(t.detail.datedetail))]):t._e()])]),t.detail.content?s("div",{staticClass:"cinfo-item"},[s("div",{staticClass:"cinfo-item-title"}),s("div",{staticClass:"cinfo-item-content"},[s("div",[t._v(t._s(t.detail.content))])])]):t._e()])]),s("div",{staticClass:"void"}),s("div",{staticClass:"card-gray"},[s("div",{staticClass:"card-gray-wrapper"},[s("div",{staticClass:"card-hd"},[s("span",{staticClass:"content-hd-icon bg1"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-laoshidianping"}})])]),t._v("\n\t\t\t\t\t\t老师点评\n\t\t\t\t\t")]),1==t.detail.isteacherevad&&t.teacherScope>0||0==t.detail.isteacherevad?s("div",{staticClass:"tcomment"},[0==t.detail.isteacherevad?s("div",{staticClass:"teacher-no-comment"},[t._v("暂未评价")]):t._e(),1==t.detail.isteacherevad&&t.teacherScope>0?s("div",{staticClass:"content-wrapper"},t._l(t.detail.teacherscope,function(e,i){return s("star",{key:i,attrs:{title:e.name,desc:e.describe,starsDesc:t.detail.listscopedesc,selectedStarsNum:e.scope}})})):t._e()]):t._e(),1==t.detail.isteacherevad&&t.teacherScope>0||0==t.detail.isteacherevad?s("div",{staticClass:"line"}):t._e(),t.detail.teachercontent||t.detail.listaudiofile.length>0||t.detail.listimgfile.length>0?s("div",{staticClass:"comment-content"},[s("div",{staticClass:"teacher-content",domProps:{innerHTML:t._s(t.app.tool.textToHtml(t.detail.teachercontent))}}),s("div",{staticClass:"voice-content"},[t.detail.listaudiofile.length>0?s("voice-recording",{attrs:{edit:!1,audioFileList:t.detail.listaudiofile}}):t._e()],1),s("div",{staticClass:"img-content"},[t.detail.listimgfile.length>0?s("img-area",{attrs:{edit:!1,imageType:1,imageFileList:t.detail.listimgfile},on:{imageLoaded:t.addScrollNum}}):t._e()],1)]):t._e()])]),t.detail.scopestar.length>0?s("div",{staticClass:"card-gray"},[s("div",{staticClass:"xuexi-star-wrapper"},[s("div",{staticClass:"card-hd"},[s("span",{staticClass:"content-hd-icon bg2"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-xuexizhixing"}})])]),t._v("\n\t\t\t\t\t\t学习之星\n\t\t\t\t\t")]),s("div",{staticClass:"topstar"},t._l(t.detail.scopestar,function(e){return s("div",{staticClass:"topstar-item"},[s("div",{staticClass:"topstar-item-img",style:"backgroundImage:url("+e.photo+")"}),s("div",{staticClass:"topstar-item-name"},[t._v(t._s(e.name))])])}))])]):t._e(),s("div",{staticClass:"void"}),1!=t.detail.isfinished||0!=t.detail.isstudentevad?s("div",{staticClass:"card-gray"},[s("div",{staticClass:"card-gray-wrapper"},[1==t.detail.isstudentevad?s("div",{staticClass:"card-hd"},[s("span",{staticClass:"content-hd-icon bg3"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-xueshengdianping"}})])]),t._v("\n\t\t\t\t\t\t学生点评\n\t\t\t\t\t")]):t._e(),0==t.detail.isstudentevad?s("div",{staticClass:"card-hd-stu"},[s("span",{staticClass:"content-hd-icon bg3"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-xueshengdianping"}})])]),t._v("\n\t\t\t\t\t\t学生点评\n\t\t\t\t\t\t"),t.detail.studentscope.length?s("div",{staticClass:"describe"},[t._v("问下孩子的感受，给老师评个分吧（匿名评价）")]):t._e()]):t._e(),0==t.detail.isstudentevad?s("div",{staticClass:"scomment"},[t._l(t.detail.studentscope,function(e,i){return s("star",{key:i,attrs:{title:e.name,desc:e.describe,starsDesc:t.detail.listscopedesc,isClick:!0,groupIndex:i,isFinished:t.detail.isfinished},on:{selectStar:t.selectStar,addScrollNum:t.addScrollNum}})}),s("div",{staticClass:"textarea-wrapper"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"textarea",staticClass:"not-comment-yet",attrs:{maxlength:"500",placeholder:t.commentTips},domProps:{value:t.content},on:{touchstart:function(e){t.app.area.start(e)},touchmove:function(e){t.app.area.move(e)},touchend:function(e){t.app.area.end(e)},input:function(e){e.target.composing||(t.content=e.target.value)}}})]),s("div",{staticClass:"scomment-submit",on:{click:t.submitComment}},[t._v("提交匿名评价")]),t.detail.remark?s("div",{staticClass:"remark"},[s("div",{staticClass:"remark-title"},[t._v("评价说明：")]),s("div",{staticClass:"remark-intro",domProps:{innerHTML:t._s(t.app.tool.changeLine(t.detail.remark))}})]):t._e()],2):t._e(),1==t.detail.isstudentevad?s("div",{staticClass:"scomment"},t._l(t.detail.studentscope,function(e,i){return s("star",{key:i,attrs:{starsDesc:t.detail.listscopedesc,title:e.name,desc:e.describe,selectedStarsNum:e.scope,groupIndex:i},on:{addScrollNum:t.addScrollNum}})})):t._e(),t.detail.studentcontent?s("div",{staticClass:"stu-content-wrapper",domProps:{innerHTML:t._s(t.app.tool.textToHtml(t.detail.studentcontent))}}):t._e()])]):t._e(),s("div",{staticClass:"void"})]):t._e(),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"loading",attrs:{bgType:"1"}})],1)},staticRenderFns:[]};var u=s("VU/8")(d,l,!1,function(t){s("3QFn")},"data-v-7201a126",null);e.default=u.exports},HR7F:function(t,e){},zGAN:function(t,e,s){"use strict";e.c=function(t){return i.a.cajax("/weixin/parent/Process.ashx",t)},e.a=function(t){return i.a.smajax("getcourseevaluate",t)},e.b=function(t){return i.a.smajax("getcourseevaluatedetail",t)},e.d=function(t){return i.a.smajax("savecoursecomment",t)};var i=s("9/YC")}});